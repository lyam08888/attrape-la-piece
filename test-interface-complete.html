<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Interface Complète - Super Pixel Adventure 2</title>
    
    <!-- Polices -->
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <!-- Font Awesome pour les icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles de l'interface modulaire -->
    <link rel="stylesheet" href="modularUI.css">
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            font-family: 'VT323', monospace;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        .test-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to bottom, rgba(40, 40, 40, 0.95), rgba(20, 20, 20, 0.95));
            border-bottom: 2px solid #555;
            padding: 10px 20px;
            z-index: 400;
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .test-title {
            color: #FF9800;
            font-size: 1.5rem;
            margin: 0;
        }

        .test-status {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #fff;
            font-size: 14px;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #666;
        }

        .status-indicator.success { background: #4CAF50; }
        .status-indicator.error { background: #F44336; }
        .status-indicator.warning { background: #FF9800; }

        .test-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(to bottom, rgba(40, 40, 40, 0.95), rgba(20, 20, 20, 0.95));
            border: 2px solid #555;
            border-radius: 25px;
            padding: 10px 20px;
            z-index: 400;
            backdrop-filter: blur(10px);
            display: flex;
            gap: 10px;
        }

        .test-btn {
            padding: 8px 16px;
            background: linear-gradient(to bottom, #4a4a4a, #2a2a2a);
            border: 1px solid #666;
            border-radius: 20px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'VT323', monospace;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .test-btn:hover {
            background: linear-gradient(to bottom, #FF9800, #F57C00);
            color: #000;
            transform: translateY(-2px);
        }

        .test-log {
            position: fixed;
            top: 60px;
            right: 20px;
            width: 300px;
            height: 200px;
            background: linear-gradient(to bottom, rgba(40, 40, 40, 0.95), rgba(20, 20, 20, 0.95));
            border: 2px solid #555;
            border-radius: 8px;
            padding: 10px;
            z-index: 300;
            backdrop-filter: blur(10px);
            overflow-y: auto;
            font-size: 12px;
            color: #fff;
        }

        .log-entry {
            margin: 2px 0;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .log-entry.success { background: rgba(76, 175, 80, 0.2); color: #4CAF50; }
        .log-entry.error { background: rgba(244, 67, 54, 0.2); color: #F44336; }
        .log-entry.warning { background: rgba(255, 152, 0, 0.2); color: #FF9800; }
        .log-entry.info { background: rgba(33, 150, 243, 0.2); color: #2196F3; }

        .progress-bar {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #555;
            border-radius: 10px;
            overflow: hidden;
            z-index: 400;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #66BB6A);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }
    </style>
</head>
<body>
    <!-- En-tête de test -->
    <div class="test-header">
        <h1 class="test-title">Test Interface Complète</h1>
        <div class="test-status">
            <div class="status-item">
                <div class="status-indicator" id="windowManager-status"></div>
                <span>WindowManager</span>
            </div>
            <div class="status-item">
                <div class="status-indicator" id="gameMenus-status"></div>
                <span>GameMenus</span>
            </div>
            <div class="status-item">
                <div class="status-indicator" id="uiManager-status"></div>
                <span>UIManager</span>
            </div>
            <div class="status-item">
                <div class="status-indicator" id="gameData-status"></div>
                <span>GameData</span>
            </div>
        </div>
    </div>

    <!-- Log des tests -->
    <div class="test-log" id="testLog">
        <div class="log-entry info">Initialisation des tests...</div>
    </div>

    <!-- Barre de progression -->
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
        <div class="progress-text" id="progressText">0%</div>
    </div>

    <!-- Contrôles de test -->
    <div class="test-controls">
        <button class="test-btn" onclick="runAllTests()">
            <i class="fas fa-play"></i> Lancer Tests
        </button>
        <button class="test-btn" onclick="testWindows()">
            <i class="fas fa-window-restore"></i> Test Fenêtres
        </button>
        <button class="test-btn" onclick="testMenus()">
            <i class="fas fa-list"></i> Test Menus
        </button>
        <button class="test-btn" onclick="testData()">
            <i class="fas fa-database"></i> Test Données
        </button>
        <button class="test-btn" onclick="testNotifications()">
            <i class="fas fa-bell"></i> Test Notifications
        </button>
        <button class="test-btn" onclick="clearTests()">
            <i class="fas fa-trash"></i> Effacer
        </button>
    </div>

    <!-- Scripts de test -->
    <script type="module">
        import { windowManager } from './windowManager.js';
        import { GameMenus } from './gameMenus.js';
        import { UIManager } from './uiManager.js';
        import { GameData } from './gameData.js';

        // Variables globales pour les tests
        let testResults = {
            windowManager: false,
            gameMenus: false,
            uiManager: false,
            gameData: false
        };

        let currentTest = 0;
        let totalTests = 0;
        let gameMenus, uiManager, gameData;

        // Simuler un objet de jeu pour les tests
        const mockGame = {
            player: { x: 100, y: 100, w: 32, h: 32 },
            canvas: document.createElement('canvas'),
            paused: false,
            debugMode: false
        };

        // Fonctions utilitaires
        function log(message, type = 'info') {
            const logEl = document.getElementById('testLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
        }

        function updateStatus(component, status) {
            const indicator = document.getElementById(`${component}-status`);
            if (indicator) {
                indicator.className = `status-indicator ${status}`;
            }
            testResults[component] = status === 'success';
        }

        function updateProgress(current, total) {
            const percent = Math.round((current / total) * 100);
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressText').textContent = percent + '%';
        }

        // Tests individuels
        async function testWindowManager() {
            log('Test WindowManager...', 'info');
            
            try {
                // Test création de fenêtre
                const window1 = windowManager.createWindow('test1', 'Test Window 1', '<p>Contenu de test</p>', {
                    width: 300,
                    height: 200
                });
                
                if (!window1) throw new Error('Impossible de créer une fenêtre');
                
                // Test redimensionnement
                windowManager.resizeWindow('test1', 400, 300);
                
                // Test déplacement
                windowManager.moveWindow('test1', 100, 100);
                
                // Test focus
                windowManager.focusWindow('test1');
                
                // Test fermeture
                setTimeout(() => {
                    windowManager.closeWindow('test1');
                }, 1000);
                
                updateStatus('windowManager', 'success');
                log('✅ WindowManager: OK', 'success');
                return true;
                
            } catch (error) {
                updateStatus('windowManager', 'error');
                log(`❌ WindowManager: ${error.message}`, 'error');
                return false;
            }
        }

        async function testGameMenusSystem() {
            log('Test GameMenus...', 'info');
            
            try {
                gameMenus = new GameMenus(mockGame);
                
                if (!gameMenus) throw new Error('Impossible de créer GameMenus');
                
                // Test ouverture des menus
                gameMenus.toggleInventory();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                gameMenus.toggleCharacter();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                gameMenus.toggleQuests();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Test fermeture
                setTimeout(() => {
                    gameMenus.toggleInventory();
                    gameMenus.toggleCharacter();
                    gameMenus.toggleQuests();
                }, 2000);
                
                updateStatus('gameMenus', 'success');
                log('✅ GameMenus: OK', 'success');
                return true;
                
            } catch (error) {
                updateStatus('gameMenus', 'error');
                log(`❌ GameMenus: ${error.message}`, 'error');
                return false;
            }
        }

        async function testUIManagerSystem() {
            log('Test UIManager...', 'info');
            
            try {
                uiManager = new UIManager(mockGame);
                
                if (!uiManager) throw new Error('Impossible de créer UIManager');
                
                // Test notifications
                uiManager.showNotification('Test notification info', 'info', 2000);
                await new Promise(resolve => setTimeout(resolve, 500));
                
                uiManager.showNotification('Test notification success', 'success', 2000);
                await new Promise(resolve => setTimeout(resolve, 500));
                
                uiManager.showNotification('Test notification warning', 'warning', 2000);
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Test raccourcis (simulation)
                const testEvent = new KeyboardEvent('keydown', { key: 'i' });
                document.dispatchEvent(testEvent);
                
                updateStatus('uiManager', 'success');
                log('✅ UIManager: OK', 'success');
                return true;
                
            } catch (error) {
                updateStatus('uiManager', 'error');
                log(`❌ UIManager: ${error.message}`, 'error');
                return false;
            }
        }

        async function testGameDataSystem() {
            log('Test GameData...', 'info');
            
            try {
                gameData = new GameData(mockGame);
                
                if (!gameData) throw new Error('Impossible de créer GameData');
                
                // Test inventaire
                const testItem = {
                    id: 'test_item',
                    name: 'Objet de Test',
                    category: 'misc',
                    quantity: 1,
                    weight: 1.0,
                    value: 10,
                    quality: 'common',
                    description: 'Un objet pour tester le système',
                    icon: 'fas fa-cube'
                };
                
                const added = gameData.addItemToInventory(testItem);
                if (!added) throw new Error('Impossible d\'ajouter un objet à l\'inventaire');
                
                // Test personnage
                const statIncreased = gameData.increaseStat('strength');
                if (!statIncreased) {
                    // Donner des points d'attributs pour le test
                    gameData.character.availablePoints = 5;
                    const retryIncrease = gameData.increaseStat('strength');
                    if (!retryIncrease) throw new Error('Impossible d\'augmenter une statistique');
                }
                
                // Test expérience
                gameData.gainExperience(50);
                
                // Test quête
                const questUpdated = gameData.updateQuestProgress('first_steps', 'explore', 3);
                if (!questUpdated) throw new Error('Impossible de mettre à jour une quête');
                
                // Test sauvegarde
                const saved = gameData.saveData();
                if (!saved) throw new Error('Impossible de sauvegarder les données');
                
                updateStatus('gameData', 'success');
                log('✅ GameData: OK', 'success');
                return true;
                
            } catch (error) {
                updateStatus('gameData', 'error');
                log(`❌ GameData: ${error.message}`, 'error');
                return false;
            }
        }

        // Fonctions de test exposées globalement
        window.runAllTests = async function() {
            log('🚀 Début des tests complets...', 'info');
            currentTest = 0;
            totalTests = 4;
            
            const tests = [
                testWindowManager,
                testGameMenusSystem,
                testUIManagerSystem,
                testGameDataSystem
            ];
            
            for (let i = 0; i < tests.length; i++) {
                currentTest = i + 1;
                updateProgress(currentTest, totalTests);
                
                try {
                    await tests[i]();
                    await new Promise(resolve => setTimeout(resolve, 1000));
                } catch (error) {
                    log(`❌ Erreur dans le test ${i + 1}: ${error.message}`, 'error');
                }
            }
            
            // Résumé final
            const successCount = Object.values(testResults).filter(Boolean).length;
            const totalCount = Object.keys(testResults).length;
            
            if (successCount === totalCount) {
                log(`🎉 Tous les tests réussis! (${successCount}/${totalCount})`, 'success');
            } else {
                log(`⚠️ Tests partiellement réussis: ${successCount}/${totalCount}`, 'warning');
            }
            
            updateProgress(totalTests, totalTests);
        };

        window.testWindows = testWindowManager;
        window.testMenus = testGameMenusSystem;
        window.testData = testGameDataSystem;
        
        window.testNotifications = function() {
            if (!uiManager) {
                log('UIManager non initialisé', 'warning');
                return;
            }
            
            const notifications = [
                { message: 'Test Info', type: 'info' },
                { message: 'Test Succès', type: 'success' },
                { message: 'Test Avertissement', type: 'warning' },
                { message: 'Test Erreur', type: 'error' }
            ];
            
            notifications.forEach((notif, index) => {
                setTimeout(() => {
                    uiManager.showNotification(notif.message, notif.type, 3000);
                }, index * 500);
            });
        };
        
        window.clearTests = function() {
            document.getElementById('testLog').innerHTML = '<div class="log-entry info">Log effacé...</div>';
            updateProgress(0, 100);
            
            // Réinitialiser les statuts
            Object.keys(testResults).forEach(key => {
                updateStatus(key, '');
                testResults[key] = false;
            });
            
            // Fermer toutes les fenêtres
            windowManager.windows.forEach((window, id) => {
                windowManager.closeWindow(id);
            });
        };

        // Initialisation
        log('Interface de test chargée', 'success');
        log('Cliquez sur "Lancer Tests" pour commencer', 'info');
        
        // Raccourcis clavier pour les tests
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'F5':
                    e.preventDefault();
                    runAllTests();
                    break;
                case 'F1':
                    e.preventDefault();
                    log('Raccourcis: F5 = Tests complets, F2 = Effacer, Échap = Fermer fenêtres', 'info');
                    break;
                case 'F2':
                    e.preventDefault();
                    clearTests();
                    break;
                case 'Escape':
                    windowManager.windows.forEach((window, id) => {
                        windowManager.closeWindow(id);
                    });
                    break;
            }
        });

        console.log('🧪 Interface de Test - Super Pixel Adventure 2');
        console.log('📋 Tests disponibles:');
        console.log('   • WindowManager: Gestion des fenêtres');
        console.log('   • GameMenus: Tous les menus du jeu');
        console.log('   • UIManager: Interface utilisateur');
        console.log('   • GameData: Données du jeu');
        console.log('⌨️  Raccourcis: F5 (Tests), F1 (Aide), F2 (Effacer), Échap (Fermer)');
    </script>
</body>
</html>