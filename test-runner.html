<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Testeur Complet du Jeu - Super Pixel Adventure 2</title>
<style>
  body { font-family: monospace; background: #111; color: #eee; margin: 0; display: flex; flex-direction: column; height: 100vh; }
  #gameContainer { flex: 1; background: #000; display: flex; justify-content: center; align-items: center; }
  canvas { border: 1px solid #444; }
  #logContainer { height: 150px; background: #222; overflow-y: auto; padding: 5px; font-size: 12px; }
  #controls { background: #222; padding: 5px; display: flex; gap: 10px; }
  button { background: #444; border: none; color: #eee; padding: 5px 10px; cursor: pointer; }
  button:hover { background: #666; }
</style>
</head>
<body>

<div id="controls">
  <button id="startBtn">Démarrer le Jeu</button>
  <button id="resetBtn">Réinitialiser</button>
  <button id="clearLogBtn">Effacer les Logs</button>
</div>

<div id="gameContainer">
  <canvas id="gameCanvas" width="800" height="450" tabindex="0"></canvas>
</div>

<div id="logContainer"></div>

<script type="module">
  import { startGameSequence } from './main.js';

  const logContainer = document.getElementById('logContainer');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const clearLogBtn = document.getElementById('clearLogBtn');
  const canvas = document.getElementById('gameCanvas');

  function logMessage(message, type = 'info') {
    const div = document.createElement('div');
    div.textContent = `[${type.toUpperCase()}] ${message}`;
    div.style.color = type === 'error' ? 'red' : (type === 'warn' ? 'orange' : 'lightgreen');
    logContainer.appendChild(div);
    logContainer.scrollTop = logContainer.scrollHeight;
  }

  window.onerror = function(message, source, lineno, colno, error) {
    logMessage(`${message} at ${source}:${lineno}:${colno}`, 'error');
  };

  window.console.log = (function(origLog) {
    return function(...args) {
      logMessage(args.join(' '), 'info');
      origLog.apply(console, args);
    };
  })(window.console.log);

  window.console.error = (function(origError) {
    return function(...args) {
      logMessage(args.join(' '), 'error');
      origError.apply(console, args);
    };
  })(window.console.error);

  let gameStarted = false;

  startBtn.onclick = async () => {
    if (gameStarted) {
      logMessage('Le jeu est déjà démarré.', 'warn');
      return;
    }
    try {
      logMessage('Démarrage du jeu...');
      await startGameSequence();
      gameStarted = true;
      logMessage('Jeu démarré avec succès.');
      canvas.focus();
    } catch (e) {
      logMessage(`Erreur lors du démarrage: ${e.message}`, 'error');
    }
  };

  resetBtn.onclick = () => {
    location.reload();
  };

  clearLogBtn.onclick = () => {
    logContainer.innerHTML = '';
  };
</script>

</body>
</html>
