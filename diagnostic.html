<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic - Super Pixel Adventure 2</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'VT323', monospace;
            background: #1a1a1a;
            color: #00ff00;
            margin: 0;
            padding: 20px;
            font-size: 16px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #000;
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #00ffff;
            font-size: 2.5em;
            margin-bottom: 30px;
        }
        
        .diagnostic-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 5px;
            background: #111;
        }
        
        .diagnostic-section h2 {
            color: #ffff00;
            margin-top: 0;
        }
        
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .status-ok { background: #008000; color: white; }
        .status-warning { background: #ff8000; color: white; }
        .status-error { background: #ff0000; color: white; }
        
        .log {
            background: #222;
            border: 1px solid #444;
            padding: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        button {
            background: #333;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            font-size: 16px;
            margin: 5px;
        }
        
        button:hover {
            background: #00ff00;
            color: #000;
        }
        
        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .file-item {
            background: #222;
            border: 1px solid #444;
            padding: 10px;
            border-radius: 3px;
        }
        
        .file-exists { border-color: #008000; }
        .file-missing { border-color: #ff0000; }
        .file-error { border-color: #ff8000; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Diagnostic du Jeu</h1>
        
        <div class="diagnostic-section">
            <h2>üìÅ V√©rification des Fichiers</h2>
            <button onclick="checkFiles()">V√©rifier les Fichiers</button>
            <div id="file-status" class="file-list"></div>
        </div>
        
        <div class="diagnostic-section">
            <h2>üì¶ Modules JavaScript</h2>
            <button onclick="checkModules()">Tester les Modules</button>
            <div id="module-status"></div>
            <div id="module-log" class="log"></div>
        </div>
        
        <div class="diagnostic-section">
            <h2>üéÆ Syst√®mes de Jeu</h2>
            <button onclick="checkGameSystems()">Tester les Syst√®mes</button>
            <div id="system-status"></div>
            <div id="system-log" class="log"></div>
        </div>
        
        <div class="diagnostic-section">
            <h2>üñ•Ô∏è Interface RPG</h2>
            <button onclick="checkRPGInterface()">Tester l'Interface</button>
            <div id="rpg-status"></div>
            <div id="rpg-log" class="log"></div>
        </div>
        
        <div class="diagnostic-section">
            <h2>üöÄ Test de D√©marrage</h2>
            <button onclick="testGameStart()">Test Complet</button>
            <div id="start-status"></div>
            <div id="start-log" class="log"></div>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button onclick="window.open('index.html', '_blank')" style="font-size: 1.2em; padding: 15px 30px;">
                üéÆ Lancer le Jeu
            </button>
        </div>
    </div>

    <script>
        // Liste des fichiers essentiels
        const essentialFiles = [
            'index.html',
            'style.css',
            'rpgInterface.css',
            'engine.js',
            'player.js',
            'world.js',
            'rpgInterfaceManager.js',
            'miningEngine.js',
            'game.js',
            'config.json'
        ];
        
        // Liste des modules √† tester
        const modules = [
            { name: 'Engine', file: './engine.js', export: 'GameEngine' },
            { name: 'Player', file: './player.js', export: 'Player' },
            { name: 'World', file: './world.js', export: 'TILE' },
            { name: 'RPG Interface', file: './rpgInterfaceManager.js', export: 'RPGInterfaceManager' },
            { name: 'Mining', file: './miningEngine.js', export: 'updateMining' }
        ];
        
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff0000' : type === 'warning' ? '#ff8000' : '#00ff00';
            element.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            element.scrollTop = element.scrollHeight;
        }
        
        async function checkFiles() {
            const statusDiv = document.getElementById('file-status');
            statusDiv.innerHTML = '';
            
            for (const file of essentialFiles) {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'file-item';
                fileDiv.innerHTML = `<strong>${file}</strong><br><span id="status-${file}">V√©rification...</span>`;
                statusDiv.appendChild(fileDiv);
                
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        document.getElementById(`status-${file}`).innerHTML = '<span class="status status-ok">‚úÖ Existe</span>';
                        fileDiv.classList.add('file-exists');
                    } else {
                        document.getElementById(`status-${file}`).innerHTML = '<span class="status status-error">‚ùå Manquant</span>';
                        fileDiv.classList.add('file-missing');
                    }
                } catch (error) {
                    document.getElementById(`status-${file}`).innerHTML = '<span class="status status-error">‚ùå Erreur</span>';
                    fileDiv.classList.add('file-error');
                }
            }
        }
        
        async function checkModules() {
            const statusDiv = document.getElementById('module-status');
            const logDiv = document.getElementById('module-log');
            statusDiv.innerHTML = '';
            logDiv.innerHTML = '';
            
            log('module-log', 'D√©but du test des modules...', 'info');
            
            for (const module of modules) {
                const moduleDiv = document.createElement('div');
                moduleDiv.innerHTML = `<strong>${module.name}:</strong> <span id="module-${module.name}">Test...</span>`;
                statusDiv.appendChild(moduleDiv);
                
                try {
                    log('module-log', `Test du module ${module.name}...`, 'info');
                    const imported = await import(module.file);
                    
                    if (imported[module.export]) {
                        document.getElementById(`module-${module.name}`).innerHTML = '<span class="status status-ok">‚úÖ OK</span>';
                        log('module-log', `${module.name}: Export ${module.export} trouv√©`, 'info');
                    } else {
                        document.getElementById(`module-${module.name}`).innerHTML = '<span class="status status-warning">‚ö†Ô∏è Export manquant</span>';
                        log('module-log', `${module.name}: Export ${module.export} manquant`, 'warning');
                    }
                } catch (error) {
                    document.getElementById(`module-${module.name}`).innerHTML = '<span class="status status-error">‚ùå Erreur</span>';
                    log('module-log', `${module.name}: ${error.message}`, 'error');
                }
            }
        }
        
        async function checkGameSystems() {
            const statusDiv = document.getElementById('system-status');
            const logDiv = document.getElementById('system-log');
            statusDiv.innerHTML = '';
            logDiv.innerHTML = '';
            
            log('system-log', 'Test des syst√®mes de jeu...', 'info');
            
            // Test du moteur
            try {
                const { GameEngine } = await import('./engine.js');
                const canvas = document.createElement('canvas');
                const engine = new GameEngine(canvas, { tileSize: 16 });
                statusDiv.innerHTML += '<div><strong>Moteur:</strong> <span class="status status-ok">‚úÖ OK</span></div>';
                log('system-log', 'Moteur de jeu: OK', 'info');
            } catch (error) {
                statusDiv.innerHTML += '<div><strong>Moteur:</strong> <span class="status status-error">‚ùå Erreur</span></div>';
                log('system-log', `Moteur de jeu: ${error.message}`, 'error');
            }
            
            // Test du joueur
            try {
                const { Player } = await import('./player.js');
                const config = {
                    player: { width: 16, height: 24, hitbox: { offsetX: 2, offsetY: 4, width: 12, height: 20 } },
                    physics: { gravity: 0.35 }
                };
                const player = new Player(0, 0, config, null);
                statusDiv.innerHTML += '<div><strong>Joueur:</strong> <span class="status status-ok">‚úÖ OK</span></div>';
                log('system-log', 'Syst√®me joueur: OK', 'info');
            } catch (error) {
                statusDiv.innerHTML += '<div><strong>Joueur:</strong> <span class="status status-error">‚ùå Erreur</span></div>';
                log('system-log', `Syst√®me joueur: ${error.message}`, 'error');
            }
            
            // Test du monde
            try {
                const { generateLevel, TILE } = await import('./world.js');
                const world = generateLevel(10, 10, 'test');
                if (world && world.length > 0) {
                    statusDiv.innerHTML += '<div><strong>Monde:</strong> <span class="status status-ok">‚úÖ OK</span></div>';
                    log('system-log', 'G√©n√©ration du monde: OK', 'info');
                } else {
                    throw new Error('Monde vide');
                }
            } catch (error) {
                statusDiv.innerHTML += '<div><strong>Monde:</strong> <span class="status status-error">‚ùå Erreur</span></div>';
                log('system-log', `G√©n√©ration du monde: ${error.message}`, 'error');
            }
        }
        
        async function checkRPGInterface() {
            const statusDiv = document.getElementById('rpg-status');
            const logDiv = document.getElementById('rpg-log');
            statusDiv.innerHTML = '';
            logDiv.innerHTML = '';
            
            log('rpg-log', 'Test de l\'interface RPG...', 'info');
            
            try {
                const { RPGInterfaceManager } = await import('./rpgInterfaceManager.js');
                const rpgInterface = new RPGInterfaceManager();
                
                statusDiv.innerHTML += '<div><strong>Interface RPG:</strong> <span class="status status-ok">‚úÖ OK</span></div>';
                log('rpg-log', 'Interface RPG: Charg√©e avec succ√®s', 'info');
                
                // Test des m√©thodes
                if (rpgInterface.showNotification) {
                    rpgInterface.showNotification('Test diagnostic', 'info', 2000);
                    log('rpg-log', 'M√©thode showNotification: OK', 'info');
                }
                
                if (rpgInterface.updateHUD) {
                    log('rpg-log', 'M√©thode updateHUD: Disponible', 'info');
                }
                
            } catch (error) {
                statusDiv.innerHTML += '<div><strong>Interface RPG:</strong> <span class="status status-error">‚ùå Erreur</span></div>';
                log('rpg-log', `Interface RPG: ${error.message}`, 'error');
            }
        }
        
        async function testGameStart() {
            const statusDiv = document.getElementById('start-status');
            const logDiv = document.getElementById('start-log');
            statusDiv.innerHTML = '';
            logDiv.innerHTML = '';
            
            log('start-log', 'Test de d√©marrage complet...', 'info');
            
            try {
                // Simuler le d√©marrage du jeu
                log('start-log', 'Chargement des modules...', 'info');
                
                const engineModule = await import('./engine.js');
                const playerModule = await import('./player.js');
                const worldModule = await import('./world.js');
                
                log('start-log', 'Modules charg√©s avec succ√®s', 'info');
                
                // Test de configuration
                const config = {
                    tileSize: 16,
                    zoom: 3,
                    player: { width: 16, height: 24, hitbox: { offsetX: 2, offsetY: 4, width: 12, height: 20 } },
                    physics: { gravity: 0.35, jumpForce: 8 }
                };
                
                log('start-log', 'Configuration cr√©√©e', 'info');
                
                // Test de cr√©ation des objets
                const canvas = document.createElement('canvas');
                canvas.width = 800;
                canvas.height = 600;
                
                const engine = new engineModule.GameEngine(canvas, config);
                const player = new playerModule.Player(100, 100, config, null);
                const world = worldModule.generateLevel(50, 50, 'test');
                
                log('start-log', 'Objets de jeu cr√©√©s avec succ√®s', 'info');
                
                statusDiv.innerHTML = '<div><strong>D√©marrage:</strong> <span class="status status-ok">‚úÖ Pr√™t</span></div>';
                log('start-log', 'üéâ Le jeu peut d√©marrer !', 'info');
                
            } catch (error) {
                statusDiv.innerHTML = '<div><strong>D√©marrage:</strong> <span class="status status-error">‚ùå √âchec</span></div>';
                log('start-log', `Erreur de d√©marrage: ${error.message}`, 'error');
                log('start-log', `Stack: ${error.stack}`, 'error');
            }
        }
        
        // Lancer automatiquement certains tests
        window.addEventListener('load', () => {
            setTimeout(checkFiles, 500);
            setTimeout(checkModules, 1500);
        });
    </script>
</body>
</html>