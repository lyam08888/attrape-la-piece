<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Int√©gration Compl√®te - Super Pixel Adventure 2 RPG</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="rpgInterface.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'VT323', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-header h1 {
            font-size: 3em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .test-card h3 {
            margin-top: 0;
            color: #FFD700;
            font-size: 1.5em;
        }
        
        .test-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .status-success {
            background: #4CAF50;
            color: white;
        }
        
        .status-warning {
            background: #FF9800;
            color: white;
        }
        
        .status-error {
            background: #F44336;
            color: white;
        }
        
        .test-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            font-size: 1.2em;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .game-canvas-container {
            width: 100%;
            height: 400px;
            border: 2px solid #FFD700;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
        }
        
        #testCanvas {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #87CEEB 0%, #32CD32 30%, #8B4513 70%, #8B0000 100%);
        }
        
        .controls-info {
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .controls-info h4 {
            color: #FFD700;
            margin-top: 0;
        }
        
        .control-key {
            background: #333;
            color: #FFD700;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üéÆ Test Int√©gration Compl√®te</h1>
            <p>Super Pixel Adventure 2 - RPG Edition</p>
        </div>
        
        <div class="test-grid">
            <div class="test-card">
                <h3>üéØ Interface RPG</h3>
                <div id="rpg-status" class="test-status status-warning">En cours de test...</div>
                <p>Interface RPG compl√®te avec 8 fen√™tres modulaires</p>
                <button class="test-button" onclick="testRPGInterface()">Tester Interface</button>
            </div>
            
            <div class="test-card">
                <h3>üë§ Syst√®me Joueur</h3>
                <div id="player-status" class="test-status status-warning">En cours de test...</div>
                <p>Statistiques RPG, niveau, exp√©rience, r√©g√©n√©ration</p>
                <button class="test-button" onclick="testPlayerSystem()">Tester Joueur</button>
            </div>
            
            <div class="test-card">
                <h3>‚õèÔ∏è Syst√®me de Minage</h3>
                <div id="mining-status" class="test-status status-warning">En cours de test...</div>
                <p>Minage avec notifications RPG et gain d'exp√©rience</p>
                <button class="test-button" onclick="testMiningSystem()">Tester Minage</button>
            </div>
            
            <div class="test-card">
                <h3>üåç G√©n√©ration Monde</h3>
                <div id="world-status" class="test-status status-warning">En cours de test...</div>
                <p>Monde RPG avec biomes du Paradis √† l'Enfer</p>
                <button class="test-button" onclick="testWorldGeneration()">Tester Monde</button>
            </div>
            
            <div class="test-card">
                <h3>üéÆ Moteur de Jeu</h3>
                <div id="engine-status" class="test-status status-warning">En cours de test...</div>
                <p>Moteur int√©gr√© avec interface RPG</p>
                <button class="test-button" onclick="testGameEngine()">Tester Moteur</button>
            </div>
            
            <div class="test-card">
                <h3>üîß Int√©gration Compl√®te</h3>
                <div id="integration-status" class="test-status status-warning">En cours de test...</div>
                <p>Tous les syst√®mes fonctionnent ensemble</p>
                <button class="test-button" onclick="testCompleteIntegration()">Test Complet</button>
            </div>
        </div>
        
        <div class="controls-info">
            <h4>üéÆ Contr√¥les de l'Interface RPG</h4>
            <p>
                <span class="control-key">I</span> Inventaire ‚Ä¢ 
                <span class="control-key">C</span> Personnage ‚Ä¢ 
                <span class="control-key">Q</span> Qu√™tes ‚Ä¢ 
                <span class="control-key">M</span> Carte ‚Ä¢ 
                <span class="control-key">O</span> Artisanat ‚Ä¢ 
                <span class="control-key">J</span> Journal ‚Ä¢ 
                <span class="control-key">ESC</span> Param√®tres
            </p>
        </div>
        
        <div class="game-canvas-container">
            <canvas id="testCanvas" width="800" height="400"></canvas>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="test-button" onclick="window.open('index.html', '_blank')" style="font-size: 1.5em; padding: 15px 30px;">
                üöÄ Lancer le Jeu Complet
            </button>
        </div>
    </div>

    <script type="module">
        // Tests d'int√©gration
        let testResults = {
            rpg: false,
            player: false,
            mining: false,
            world: false,
            engine: false,
            integration: false
        };

        // Test de l'interface RPG
        window.testRPGInterface = async function() {
            try {
                const { RPGInterfaceManager } = await import('./rpgInterfaceManager.js');
                const rpgInterface = new RPGInterfaceManager();
                
                // Tester les m√©thodes principales
                rpgInterface.showNotification('Test Interface RPG', 'success', 2000);
                
                document.getElementById('rpg-status').textContent = '‚úÖ Interface RPG OK';
                document.getElementById('rpg-status').className = 'test-status status-success';
                testResults.rpg = true;
                
                setTimeout(() => {
                    rpgInterface.showNotification('Interface RPG fonctionnelle !', 'info', 3000);
                }, 1000);
                
            } catch (error) {
                console.error('Erreur test RPG:', error);
                document.getElementById('rpg-status').textContent = '‚ùå Erreur Interface RPG';
                document.getElementById('rpg-status').className = 'test-status status-error';
            }
        };

        // Test du syst√®me joueur
        window.testPlayerSystem = async function() {
            try {
                const { Player } = await import('./player.js');
                
                const config = {
                    player: { width: 16, height: 24, hitbox: { offsetX: 2, offsetY: 4, width: 12, height: 20 } },
                    physics: { gravity: 0.35, jumpForce: 8 },
                    playerAnimations: { idle: ['player_idle1'] }
                };
                
                const player = new Player(100, 100, config, null);
                
                // Tester les m√©thodes RPG
                player.gainExperience(50);
                player.regenerateStats(16);
                const stats = player.getRPGStats();
                
                if (stats.level >= 1 && stats.health > 0) {
                    document.getElementById('player-status').textContent = '‚úÖ Syst√®me Joueur OK';
                    document.getElementById('player-status').className = 'test-status status-success';
                    testResults.player = true;
                } else {
                    throw new Error('Statistiques invalides');
                }
                
            } catch (error) {
                console.error('Erreur test Player:', error);
                document.getElementById('player-status').textContent = '‚ùå Erreur Syst√®me Joueur';
                document.getElementById('player-status').className = 'test-status status-error';
            }
        };

        // Test du syst√®me de minage
        window.testMiningSystem = async function() {
            try {
                const { integrateMiningWithRPG } = await import('./miningEngine.js');
                
                // Simuler un objet game
                const mockGame = {
                    rpgInterface: {
                        showNotification: (msg, type, duration) => {
                            console.log(`Notification: ${msg}`);
                        }
                    }
                };
                
                integrateMiningWithRPG(mockGame);
                
                document.getElementById('mining-status').textContent = '‚úÖ Syst√®me Minage OK';
                document.getElementById('mining-status').className = 'test-status status-success';
                testResults.mining = true;
                
            } catch (error) {
                console.error('Erreur test Mining:', error);
                document.getElementById('mining-status').textContent = '‚ùå Erreur Syst√®me Minage';
                document.getElementById('mining-status').className = 'test-status status-error';
            }
        };

        // Test de g√©n√©ration du monde
        window.testWorldGeneration = async function() {
            try {
                const { TILE, generateLevel } = await import('./world.js');
                
                const world = generateLevel(100, 100, 'test-seed');
                
                if (world && world.length > 0 && world[0].length > 0) {
                    document.getElementById('world-status').textContent = '‚úÖ G√©n√©ration Monde OK';
                    document.getElementById('world-status').className = 'test-status status-success';
                    testResults.world = true;
                    
                    // Dessiner un aper√ßu du monde
                    drawWorldPreview(world);
                } else {
                    throw new Error('Monde non g√©n√©r√©');
                }
                
            } catch (error) {
                console.error('Erreur test World:', error);
                document.getElementById('world-status').textContent = '‚ùå Erreur G√©n√©ration Monde';
                document.getElementById('world-status').className = 'test-status status-error';
            }
        };

        // Test du moteur de jeu
        window.testGameEngine = async function() {
            try {
                const { GameEngine } = await import('./engine.js');
                
                const canvas = document.getElementById('testCanvas');
                const config = { tileSize: 16, zoom: 2 };
                const engine = new GameEngine(canvas, config);
                
                if (engine && engine.canvas && engine.ctx) {
                    document.getElementById('engine-status').textContent = '‚úÖ Moteur de Jeu OK';
                    document.getElementById('engine-status').className = 'test-status status-success';
                    testResults.engine = true;
                } else {
                    throw new Error('Moteur non initialis√©');
                }
                
            } catch (error) {
                console.error('Erreur test Engine:', error);
                document.getElementById('engine-status').textContent = '‚ùå Erreur Moteur de Jeu';
                document.getElementById('engine-status').className = 'test-status status-error';
            }
        };

        // Test d'int√©gration compl√®te
        window.testCompleteIntegration = async function() {
            try {
                // V√©rifier que tous les tests pr√©c√©dents sont pass√©s
                const allTestsPassed = Object.values(testResults).every(result => result === true);
                
                if (allTestsPassed) {
                    document.getElementById('integration-status').textContent = '‚úÖ Int√©gration Compl√®te OK';
                    document.getElementById('integration-status').className = 'test-status status-success';
                    testResults.integration = true;
                    
                    // Afficher un message de succ√®s
                    alert('üéâ Tous les syst√®mes sont int√©gr√©s avec succ√®s !\n\nVous pouvez maintenant lancer le jeu complet.');
                } else {
                    throw new Error('Certains tests ont √©chou√©');
                }
                
            } catch (error) {
                console.error('Erreur test Integration:', error);
                document.getElementById('integration-status').textContent = '‚ùå Erreur Int√©gration';
                document.getElementById('integration-status').className = 'test-status status-error';
                
                // FIXED: Show which tests failed
                const failedTests = Object.entries(testResults)
                    .filter(([key, value]) => !value)
                    .map(([key]) => key);
                
                alert(`‚ö†Ô∏è Certains syst√®mes ne sont pas correctement int√©gr√©s.\nTests √©chou√©s: ${failedTests.join(', ')}\nVeuillez v√©rifier les tests individuels.`);
            }
        };

        // Fonction pour dessiner un aper√ßu du monde
        function drawWorldPreview(world) {
            const canvas = document.getElementById('testCanvas');
            const ctx = canvas.getContext('2d');
            
            const tileSize = Math.min(canvas.width / world[0].length, canvas.height / world.length);
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            for (let y = 0; y < world.length; y++) {
                for (let x = 0; x < world[0].length; x++) {
                    const tileType = world[y][x];
                    
                    // Couleurs selon le type de tuile
                    let color = '#000000';
                    switch (tileType) {
                        case 0: color = '#87CEEB'; break; // Air/Ciel
                        case 1: color = '#32CD32'; break; // Herbe
                        case 2: color = '#8B4513'; break; // Terre
                        case 3: color = '#696969'; break; // Pierre
                        case 4: color = '#8B4513'; break; // Bois
                        case 5: color = '#228B22'; break; // Feuilles
                        case 71: color = '#FFD700'; break; // Pierre divine
                        case 101: color = '#8B0000'; break; // Pierre infernale
                        case 111: color = '#2F2F2F'; break; // Pierre du vide
                        default: color = '#666666';
                    }
                    
                    ctx.fillStyle = color;
                    ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
                }
            }
            
            // Ajouter du texte
            ctx.fillStyle = '#FFFFFF';
            ctx.font = '16px VT323';
            ctx.fillText('Aper√ßu du Monde RPG', 10, 30);
            ctx.fillText('Du Paradis (haut) √† l\'Enfer (bas)', 10, 50);
        }

        // FIXED: Lancer automatiquement certains tests au chargement avec gestion d'erreurs
        window.addEventListener('load', () => {
            setTimeout(async () => {
                try {
                    await testRPGInterface();
                } catch (error) {
                    console.error('Erreur lors du test RPG automatique:', error);
                }
            }, 1000);
            
            setTimeout(async () => {
                try {
                    await testPlayerSystem();
                } catch (error) {
                    console.error('Erreur lors du test Player automatique:', error);
                }
            }, 2000);
            
            setTimeout(async () => {
                try {
                    await testMiningSystem();
                } catch (error) {
                    console.error('Erreur lors du test Mining automatique:', error);
                }
            }, 3000);
            
            setTimeout(async () => {
                try {
                    await testWorldGeneration();
                } catch (error) {
                    console.error('Erreur lors du test World automatique:', error);
                }
            }, 4000);
            
            setTimeout(async () => {
                try {
                    await testGameEngine();
                } catch (error) {
                    console.error('Erreur lors du test Engine automatique:', error);
                }
            }, 5000);
        });
    </script>
</body>
</html>