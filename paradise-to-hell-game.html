<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Pixel Adventure 2 - Du Paradis à l'Enfer</title>
    
    <!-- Polices -->
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Font Awesome pour les icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles de l'interface modulaire -->
    <link rel="stylesheet" href="modularUI.css">
    <link rel="stylesheet" href="windows11-style.css">
    
    <!-- Styles pour l'intégration des fenêtres dans le jeu -->
    <style>
        /* Intégration des fenêtres modulaires dans le jeu */
        .game-window {
            position: fixed;
            background: linear-gradient(135deg, 
                rgba(20, 20, 30, 0.95) 0%,
                rgba(40, 40, 60, 0.95) 100%
            );
            border: 2px solid #FFD700;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(15px);
            z-index: 1000;
            min-width: 300px;
            min-height: 200px;
            display: none;
            overflow: hidden;
        }

        .game-window.visible {
            display: block;
            animation: windowAppear 0.3s ease-out;
        }

        @keyframes windowAppear {
            from { 
                opacity: 0; 
                transform: scale(0.9) translateY(-20px); 
            }
            to { 
                opacity: 1; 
                transform: scale(1) translateY(0); 
            }
        }

        .game-window-header {
            background: linear-gradient(90deg, 
                rgba(255, 215, 0, 0.2) 0%,
                rgba(255, 140, 0, 0.2) 100%
            );
            border-bottom: 1px solid #FFD700;
            padding: 12px 16px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .game-window-title {
            color: #FFD700;
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .game-window-controls {
            display: flex;
            gap: 8px;
        }

        .game-window-btn {
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .game-window-btn.minimize {
            background: #FFA500;
            color: #000;
        }

        .game-window-btn.maximize {
            background: #32CD32;
            color: #000;
        }

        .game-window-btn.close {
            background: #FF4500;
            color: #FFF;
        }

        .game-window-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .game-window-content {
            padding: 16px;
            height: calc(100% - 60px);
            overflow-y: auto;
            color: #E0E0E0;
        }

        /* Styles spécifiques pour chaque type de fenêtre */
        .inventory-window {
            width: 600px;
            height: 500px;
            top: 10%;
            left: 10%;
        }

        .character-window {
            width: 500px;
            height: 600px;
            top: 5%;
            right: 10%;
        }

        .quest-window {
            width: 450px;
            height: 550px;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
        }

        .map-window {
            width: 700px;
            height: 500px;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
        }

        .crafting-window {
            width: 650px;
            height: 450px;
            bottom: 10%;
            left: 10%;
        }

        .journal-window {
            width: 550px;
            height: 400px;
            top: 20%;
            right: 5%;
        }

        .trade-window {
            width: 600px;
            height: 500px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .dialogue-window {
            width: 500px;
            height: 300px;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, 
                rgba(40, 20, 60, 0.95) 0%,
                rgba(60, 40, 80, 0.95) 100%
            );
            border-color: #9370DB;
        }

        /* Taskbar pour les fenêtres ouvertes */
        .game-taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(90deg, 
                rgba(20, 20, 30, 0.95) 0%,
                rgba(40, 40, 60, 0.95) 100%
            );
            border-top: 2px solid #FFD700;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 10px;
            z-index: 999;
            backdrop-filter: blur(10px);
        }

        .taskbar-item {
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.2) 0%,
                rgba(255, 140, 0, 0.2) 100%
            );
            border: 1px solid #FFD700;
            border-radius: 8px;
            padding: 8px 16px;
            color: #FFD700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .taskbar-item:hover {
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.3) 0%,
                rgba(255, 140, 0, 0.3) 100%
            );
            transform: translateY(-2px);
        }

        .taskbar-item.active {
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.4) 0%,
                rgba(255, 140, 0, 0.4) 100%
            );
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
        }

        /* Menu contextuel */
        .context-menu {
            position: fixed;
            background: linear-gradient(135deg, 
                rgba(20, 20, 30, 0.95) 0%,
                rgba(40, 40, 60, 0.95) 100%
            );
            border: 1px solid #FFD700;
            border-radius: 8px;
            padding: 8px 0;
            z-index: 2000;
            display: none;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .context-menu-item {
            padding: 8px 16px;
            color: #E0E0E0;
            cursor: pointer;
            transition: background 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, 
                rgba(20, 20, 30, 0.95) 0%,
                rgba(40, 40, 60, 0.95) 100%
            );
            border: 1px solid #32CD32;
            border-radius: 8px;
            padding: 16px;
            color: #32CD32;
            z-index: 1500;
            max-width: 300px;
            backdrop-filter: blur(10px);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            border-color: #FF4500;
            color: #FF4500;
        }

        .notification.warning {
            border-color: #FFA500;
            color: #FFA500;
        }
    </style>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(180deg, 
                #FFE4B5 0%,    /* Paradis doré */
                #87CEEB 15%,   /* Ciel céleste */
                #32CD32 30%,   /* Forêts vertes */
                #9370DB 45%,   /* Cristaux violets */
                #DAA520 60%,   /* Plaines dorées */
                #8B4513 75%,   /* Terres sombres */
                #8B0000 90%,   /* Enfer rouge */
                #000000 100%   /* Abysse noir */
            );
            font-family: 'VT323', monospace;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Canvas du jeu */
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
            cursor: crosshair;
        }

        /* Interface de chargement épique */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(0, 0, 0, 0.9) 0%,
                rgba(139, 0, 0, 0.8) 50%,
                rgba(255, 215, 0, 0.8) 100%
            );
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }

        .epic-title {
            font-family: 'Cinzel', serif;
            font-size: 4rem;
            font-weight: 600;
            background: linear-gradient(45deg, #FFD700, #FF4500, #8B0000);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 2rem;
            animation: titlePulse 3s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .epic-subtitle {
            font-family: 'VT323', monospace;
            font-size: 1.5rem;
            color: #FFD700;
            text-align: center;
            margin-bottom: 3rem;
            animation: subtitleGlow 2s ease-in-out infinite alternate;
        }

        @keyframes subtitleGlow {
            from { text-shadow: 0 0 10px #FFD700; }
            to { text-shadow: 0 0 20px #FFD700, 0 0 30px #FF4500; }
        }

        .loading-progress {
            width: 500px;
            height: 30px;
            background: linear-gradient(to right, 
                rgba(0, 0, 0, 0.8), 
                rgba(139, 0, 0, 0.6), 
                rgba(0, 0, 0, 0.8)
            );
            border: 3px solid #FFD700;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .loading-fill {
            height: 100%;
            background: linear-gradient(90deg, 
                #FFD700 0%, 
                #FF4500 50%, 
                #8B0000 100%
            );
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            animation: loadingShimmer 2s linear infinite;
        }

        @keyframes loadingShimmer {
            0% { box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.3); }
            50% { box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.6); }
            100% { box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.3); }
        }

        .loading-text {
            color: #FFD700;
            font-size: 1.2rem;
            margin-top: 1rem;
            text-align: center;
            animation: textFlicker 1.5s ease-in-out infinite;
        }

        @keyframes textFlicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .loading-details {
            color: #FFA500;
            font-size: 1rem;
            margin-top: 0.5rem;
            text-align: center;
            min-height: 1.5rem;
        }

        /* Interface de jeu */
        .game-hud {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            display: none;
        }

        .game-hud.visible {
            display: block;
        }

        .biome-indicator {
            background: linear-gradient(to right, 
                rgba(0, 0, 0, 0.8), 
                rgba(40, 40, 40, 0.9)
            );
            border: 2px solid #FFD700;
            border-radius: 10px;
            padding: 15px 20px;
            color: #FFD700;
            font-size: 1.2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            margin-bottom: 10px;
        }

        .biome-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .biome-description {
            font-size: 0.9rem;
            color: #FFA500;
            opacity: 0.8;
        }

        .depth-indicator {
            background: linear-gradient(to right, 
                rgba(0, 0, 0, 0.8), 
                rgba(40, 40, 40, 0.9)
            );
            border: 2px solid #FF4500;
            border-radius: 10px;
            padding: 10px 15px;
            color: #FF4500;
            font-size: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        /* Minimap */
        .minimap {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 200px;
            height: 300px;
            background: linear-gradient(180deg, 
                rgba(255, 228, 181, 0.9) 0%,
                rgba(135, 206, 235, 0.9) 15%,
                rgba(50, 205, 50, 0.9) 30%,
                rgba(147, 112, 219, 0.9) 45%,
                rgba(218, 165, 32, 0.9) 60%,
                rgba(139, 69, 19, 0.9) 75%,
                rgba(139, 0, 0, 0.9) 90%,
                rgba(0, 0, 0, 0.9) 100%
            );
            border: 3px solid #FFD700;
            border-radius: 10px;
            z-index: 100;
            display: none;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.7);
        }

        .minimap.visible {
            display: block;
        }

        .minimap-title {
            background: rgba(0, 0, 0, 0.8);
            color: #FFD700;
            text-align: center;
            padding: 5px;
            font-size: 0.9rem;
            border-bottom: 1px solid #FFD700;
        }

        .minimap-content {
            position: relative;
            height: calc(100% - 30px);
        }

        .player-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #00FF00;
            border: 1px solid #FFFFFF;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: playerPulse 1s ease-in-out infinite;
            z-index: 10;
        }

        @keyframes playerPulse {
            0%, 100% { box-shadow: 0 0 5px #00FF00; }
            50% { box-shadow: 0 0 15px #00FF00, 0 0 25px #00FF00; }
        }

        /* Contrôles */
        .controls-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: #FFD700;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 100;
            display: none;
            border: 1px solid #FFD700;
        }

        .controls-hint.visible {
            display: block;
        }

        /* Effets visuels */
        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 50;
        }

        .divine-particle {
            width: 4px;
            height: 4px;
            background: #FFD700;
            border-radius: 50%;
            animation: divineFloat 3s ease-in-out infinite;
        }

        .infernal-particle {
            width: 6px;
            height: 6px;
            background: #FF4500;
            border-radius: 50%;
            animation: infernalFlicker 1s ease-in-out infinite;
        }

        @keyframes divineFloat {
            0%, 100% { transform: translateY(0) scale(1); opacity: 0.7; }
            50% { transform: translateY(-20px) scale(1.2); opacity: 1; }
        }

        @keyframes infernalFlicker {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.3); }
        }

        /* Messages système */
        .system-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, 
                rgba(0, 0, 0, 0.9), 
                rgba(40, 40, 40, 0.9)
            );
            border: 3px solid #FFD700;
            border-radius: 15px;
            padding: 30px 40px;
            color: #FFD700;
            font-size: 1.5rem;
            text-align: center;
            z-index: 1500;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .system-message.visible {
            display: block;
            animation: messageAppear 0.5s ease-out;
        }

        @keyframes messageAppear {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .epic-title {
                font-size: 2.5rem;
            }
            
            .loading-progress {
                width: 300px;
                height: 25px;
            }
            
            .minimap {
                width: 150px;
                height: 200px;
            }
            
            .game-hud {
                top: 10px;
                left: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Écran de chargement épique -->
    <div id="loadingScreen">
        <h1 class="epic-title">Du Paradis à l'Enfer</h1>
        <p class="epic-subtitle">Une Odyssée Épique à Travers les Royaumes</p>
        
        <div class="loading-progress">
            <div class="loading-fill" id="loadingFill"></div>
        </div>
        
        <div class="loading-text" id="loadingText">Initialisation...</div>
        <div class="loading-details" id="loadingDetails">Préparation de l'aventure épique</div>
    </div>

    <!-- Canvas du jeu -->
    <canvas id="gameCanvas"></canvas>

    <!-- Interface de jeu -->
    <div class="game-hud" id="gameHUD">
        <div class="biome-indicator" id="biomeIndicator">
            <div class="biome-name" id="biomeName">Royaume Inconnu</div>
            <div class="biome-description" id="biomeDescription">Explorez pour découvrir</div>
        </div>
        
        <div class="depth-indicator" id="depthIndicator">
            Profondeur: <span id="depthValue">0</span>m
        </div>
    </div>

    <!-- Minimap -->
    <div class="minimap" id="minimap">
        <div class="minimap-title">Carte des Royaumes</div>
        <div class="minimap-content" id="minimapContent">
            <div class="player-dot" id="playerDot"></div>
        </div>
    </div>

    <!-- Contrôles -->
    <div class="controls-hint" id="controlsHint">
        WASD: Déplacement | Espace: Saut | E: Interaction | M: Carte | I: Inventaire
    </div>

    <!-- Messages système -->
    <div class="system-message" id="systemMessage"></div>

    <!-- Fenêtres modulaires du jeu -->
    
    <!-- Fenêtre Inventaire -->
    <div class="game-window inventory-window" id="inventoryWindow">
        <div class="game-window-header">
            <div class="game-window-title">
                <i class="fas fa-backpack"></i>
                Inventaire
            </div>
            <div class="game-window-controls">
                <button class="game-window-btn minimize" onclick="minimizeWindow('inventoryWindow')">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="game-window-btn maximize" onclick="maximizeWindow('inventoryWindow')">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="game-window-btn close" onclick="closeWindow('inventoryWindow')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="game-window-content" id="inventoryContent">
            <!-- Le contenu sera généré par JavaScript -->
        </div>
    </div>

    <!-- Fenêtre Personnage -->
    <div class="game-window character-window" id="characterWindow">
        <div class="game-window-header">
            <div class="game-window-title">
                <i class="fas fa-user-circle"></i>
                Personnage
            </div>
            <div class="game-window-controls">
                <button class="game-window-btn minimize" onclick="minimizeWindow('characterWindow')">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="game-window-btn maximize" onclick="maximizeWindow('characterWindow')">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="game-window-btn close" onclick="closeWindow('characterWindow')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="game-window-content" id="characterContent">
            <!-- Le contenu sera généré par JavaScript -->
        </div>
    </div>

    <!-- Fenêtre Quêtes -->
    <div class="game-window quest-window" id="questWindow">
        <div class="game-window-header">
            <div class="game-window-title">
                <i class="fas fa-scroll"></i>
                Quêtes
            </div>
            <div class="game-window-controls">
                <button class="game-window-btn minimize" onclick="minimizeWindow('questWindow')">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="game-window-btn maximize" onclick="maximizeWindow('questWindow')">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="game-window-btn close" onclick="closeWindow('questWindow')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="game-window-content" id="questContent">
            <!-- Le contenu sera généré par JavaScript -->
        </div>
    </div>

    <!-- Fenêtre Carte -->
    <div class="game-window map-window" id="mapWindow">
        <div class="game-window-header">
            <div class="game-window-title">
                <i class="fas fa-map"></i>
                Carte du Monde
            </div>
            <div class="game-window-controls">
                <button class="game-window-btn minimize" onclick="minimizeWindow('mapWindow')">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="game-window-btn maximize" onclick="maximizeWindow('mapWindow')">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="game-window-btn close" onclick="closeWindow('mapWindow')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="game-window-content" id="mapContent">
            <!-- Le contenu sera généré par JavaScript -->
        </div>
    </div>

    <!-- Fenêtre Artisanat -->
    <div class="game-window crafting-window" id="craftingWindow">
        <div class="game-window-header">
            <div class="game-window-title">
                <i class="fas fa-hammer"></i>
                Artisanat
            </div>
            <div class="game-window-controls">
                <button class="game-window-btn minimize" onclick="minimizeWindow('craftingWindow')">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="game-window-btn maximize" onclick="maximizeWindow('craftingWindow')">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="game-window-btn close" onclick="closeWindow('craftingWindow')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="game-window-content" id="craftingContent">
            <!-- Le contenu sera généré par JavaScript -->
        </div>
    </div>

    <!-- Fenêtre Journal -->
    <div class="game-window journal-window" id="journalWindow">
        <div class="game-window-header">
            <div class="game-window-title">
                <i class="fas fa-book"></i>
                Journal
            </div>
            <div class="game-window-controls">
                <button class="game-window-btn minimize" onclick="minimizeWindow('journalWindow')">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="game-window-btn maximize" onclick="maximizeWindow('journalWindow')">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="game-window-btn close" onclick="closeWindow('journalWindow')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="game-window-content" id="journalContent">
            <!-- Le contenu sera généré par JavaScript -->
        </div>
    </div>

    <!-- Fenêtre Commerce -->
    <div class="game-window trade-window" id="tradeWindow">
        <div class="game-window-header">
            <div class="game-window-title">
                <i class="fas fa-coins"></i>
                Commerce
            </div>
            <div class="game-window-controls">
                <button class="game-window-btn minimize" onclick="minimizeWindow('tradeWindow')">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="game-window-btn maximize" onclick="maximizeWindow('tradeWindow')">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="game-window-btn close" onclick="closeWindow('tradeWindow')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="game-window-content" id="tradeContent">
            <!-- Le contenu sera généré par JavaScript -->
        </div>
    </div>

    <!-- Fenêtre Dialogue -->
    <div class="game-window dialogue-window" id="dialogueWindow">
        <div class="game-window-header">
            <div class="game-window-title">
                <i class="fas fa-comments"></i>
                Dialogue
            </div>
            <div class="game-window-controls">
                <button class="game-window-btn close" onclick="closeWindow('dialogueWindow')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="game-window-content" id="dialogueContent">
            <!-- Le contenu sera généré par JavaScript -->
        </div>
    </div>

    <!-- Taskbar -->
    <div class="game-taskbar" id="gameTaskbar">
        <div class="taskbar-item" onclick="toggleWindow('inventoryWindow')" id="inventoryTask">
            <i class="fas fa-backpack"></i>
            Inventaire
        </div>
        <div class="taskbar-item" onclick="toggleWindow('characterWindow')" id="characterTask">
            <i class="fas fa-user-circle"></i>
            Personnage
        </div>
        <div class="taskbar-item" onclick="toggleWindow('questWindow')" id="questTask">
            <i class="fas fa-scroll"></i>
            Quêtes
        </div>
        <div class="taskbar-item" onclick="toggleWindow('mapWindow')" id="mapTask">
            <i class="fas fa-map"></i>
            Carte
        </div>
        <div class="taskbar-item" onclick="toggleWindow('craftingWindow')" id="craftingTask">
            <i class="fas fa-hammer"></i>
            Artisanat
        </div>
        <div class="taskbar-item" onclick="toggleWindow('journalWindow')" id="journalTask">
            <i class="fas fa-book"></i>
            Journal
        </div>
    </div>

    <!-- Menu contextuel -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="contextAction('inspect')">
            <i class="fas fa-search"></i>
            Examiner
        </div>
        <div class="context-menu-item" onclick="contextAction('use')">
            <i class="fas fa-hand-pointer"></i>
            Utiliser
        </div>
        <div class="context-menu-item" onclick="contextAction('drop')">
            <i class="fas fa-trash"></i>
            Jeter
        </div>
    </div>

    <!-- Notifications -->
    <div class="notification" id="notification">
        <div id="notificationContent"></div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { AdvancedWorldGenerator } from './advancedWorldGenerator.js';
        import { AdvancedRenderer } from './advancedRenderer.js';
        import { AdvancedNPCSystem } from './advancedNPCSystem.js';
        import { UIManager } from './uiManager.js';
        import { WindowManager } from './windowManager.js';

        class ParadiseToHellGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.worldGenerator = new AdvancedWorldGenerator();
                this.renderer = null;
                this.npcSystem = null;
                this.uiManager = null;
                this.windowManager = null;
                
                this.world = null;
                this.player = null;
                this.camera = { x: 0, y: 0 };
                this.config = {
                    tileSize: 32,
                    zoom: 1.0,
                    worldWidth: 800,
                    worldHeight: 600
                };
                
                this.gameState = {
                    loaded: false,
                    paused: false,
                    currentBiome: null,
                    depth: 0
                };
                
                this.keys = {};
                this.mouse = { x: 0, y: 0, clicked: false };
                
                this.init();
            }

            async init() {
                console.log("🌍 Initialisation du jeu Du Paradis à l'Enfer...");
                
                this.setupCanvas();
                this.setupEventListeners();
                
                await this.loadAssets();
                await this.generateWorld();
                await this.initializeSystems();
                await this.createPlayer();
                
                this.hideLoadingScreen();
                this.showGameInterface();
                this.startGameLoop();
                
                console.log("✅ Jeu initialisé avec succès!");
            }

            setupCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                
                window.addEventListener('resize', () => {
                    this.canvas.width = window.innerWidth;
                    this.canvas.height = window.innerHeight;
                });
            }

            setupEventListeners() {
                // Clavier
                document.addEventListener('keydown', (e) => {
                    this.keys[e.key.toLowerCase()] = true;
                    this.handleKeyPress(e.key.toLowerCase());
                });
                
                document.addEventListener('keyup', (e) => {
                    this.keys[e.key.toLowerCase()] = false;
                });
                
                // Souris
                this.canvas.addEventListener('mousemove', (e) => {
                    this.mouse.x = e.clientX;
                    this.mouse.y = e.clientY;
                });
                
                this.canvas.addEventListener('click', (e) => {
                    this.mouse.clicked = true;
                    this.handleMouseClick(e.clientX, e.clientY);
                });
            }

            async loadAssets() {
                this.updateLoadingProgress(10, "Chargement des ressources...", "Textures et sprites");
                
                // Simuler le chargement des assets
                await this.delay(1000);
                
                this.assets = {
                    // Les assets seront chargés ici
                    loaded: true
                };
                
                this.updateLoadingProgress(30, "Ressources chargées", "Génération du monde...");
            }

            async generateWorld() {
                this.updateLoadingProgress(40, "Génération du monde...", "Création des biomes du Paradis à l'Enfer");
                
                this.world = this.worldGenerator.generateAdvancedWorld(
                    this.config.worldWidth,
                    this.config.worldHeight,
                    this.config
                );
                
                this.updateLoadingProgress(70, "Monde généré", "Peuplement des créatures et PNJ");
                await this.delay(500);
            }

            async initializeSystems() {
                this.updateLoadingProgress(80, "Initialisation des systèmes...", "IA, rendu et interface");
                
                // Initialiser le renderer
                this.renderer = new AdvancedRenderer(this.canvas, this.assets);
                
                // Initialiser le système de PNJ
                this.npcSystem = new AdvancedNPCSystem(this);
                
                // Créer des PNJ dans le monde
                this.populateWorldWithNPCs();
                
                // Initialiser l'interface utilisateur
                this.uiManager = new UIManager(this);
                window.uiManager = this.uiManager;
                
                // Initialiser le gestionnaire de fenêtres
                this.windowManager = new WindowManager();
                window.windowManager = this.windowManager;
                
                this.updateLoadingProgress(95, "Systèmes initialisés", "Finalisation...");
                await this.delay(500);
            }

            populateWorldWithNPCs() {
                // Créer des PNJ spéciaux dans chaque biome
                const npcPlacements = [
                    { template: "ARCHANGEL_GABRIEL", x: 400, y: 50 },
                    { template: "CELESTIAL_ORACLE", x: 350, y: 100 },
                    { template: "ANCIENT_DRUID", x: 300, y: 200 },
                    { template: "CRYSTAL_SAGE", x: 250, y: 250 },
                    { template: "GOLDEN_MERCHANT", x: 200, y: 300 },
                    { template: "SWAMP_WITCH", x: 150, y: 350 },
                    { template: "SHADOW_MERCHANT", x: 100, y: 450 },
                    { template: "DEMON_LORD_BAAL", x: 50, y: 550 }
                ];
                
                npcPlacements.forEach(placement => {
                    const npc = this.npcSystem.createNPC(
                        placement.template,
                        placement.x,
                        placement.y
                    );
                    
                    if (npc) {
                        this.world.npcs.push(npc);
                    }
                });
            }

            async createPlayer() {
                this.player = {
                    x: this.config.worldWidth / 2,
                    y: 50, // Commencer au Paradis
                    w: 24,
                    h: 32,
                    vx: 0,
                    vy: 0,
                    speed: 200,
                    jumpPower: 400,
                    onGround: false,
                    health: 100,
                    maxHealth: 100,
                    mana: 50,
                    maxMana: 50,
                    level: 1,
                    experience: 0,
                    inventory: [],
                    abilities: [],
                    alignment: "neutral" // Peut devenir "good" ou "evil"
                };
                
                this.updateCamera();
                this.updateLoadingProgress(100, "Prêt à jouer!", "Que votre odyssée commence...");
            }

            hideLoadingScreen() {
                const loadingScreen = document.getElementById('loadingScreen');
                loadingScreen.style.opacity = '0';
                loadingScreen.style.transition = 'opacity 1s ease-out';
                
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    this.gameState.loaded = true;
                }, 1000);
            }

            showGameInterface() {
                document.getElementById('gameHUD').classList.add('visible');
                document.getElementById('minimap').classList.add('visible');
                document.getElementById('controlsHint').classList.add('visible');
                
                // Masquer les contrôles après 5 secondes
                setTimeout(() => {
                    document.getElementById('controlsHint').classList.remove('visible');
                }, 5000);
            }

            startGameLoop() {
                let lastTime = 0;
                
                const gameLoop = (currentTime) => {
                    const deltaTime = currentTime - lastTime;
                    lastTime = currentTime;
                    
                    if (this.gameState.loaded && !this.gameState.paused) {
                        this.update(deltaTime);
                        this.render();
                    }
                    
                    requestAnimationFrame(gameLoop);
                };
                
                requestAnimationFrame(gameLoop);
            }

            update(deltaTime) {
                if (!this.player || !this.world) return;
                
                // Mettre à jour le joueur
                this.updatePlayer(deltaTime);
                
                // Mettre à jour les systèmes
                if (this.npcSystem) {
                    this.npcSystem.update(deltaTime);
                }
                
                if (this.uiManager) {
                    this.uiManager.update();
                }
                
                // Mettre à jour la caméra
                this.updateCamera();
                
                // Mettre à jour l'interface
                this.updateGameInterface();
                
                // Vérifier les interactions
                this.checkInteractions();
            }

            updatePlayer(deltaTime) {
                const dt = deltaTime / 1000; // Convertir en secondes
                
                // Mouvement horizontal
                if (this.keys['a'] || this.keys['arrowleft']) {
                    this.player.vx = -this.player.speed;
                } else if (this.keys['d'] || this.keys['arrowright']) {
                    this.player.vx = this.player.speed;
                } else {
                    this.player.vx *= 0.8; // Friction
                }
                
                // Saut
                if ((this.keys[' '] || this.keys['w'] || this.keys['arrowup']) && this.player.onGround) {
                    this.player.vy = -this.player.jumpPower;
                    this.player.onGround = false;
                }
                
                // Gravité
                this.player.vy += 800 * dt; // Gravité
                
                // Appliquer la vélocité
                this.player.x += this.player.vx * dt;
                this.player.y += this.player.vy * dt;
                
                // Collision avec les limites du monde
                this.player.x = Math.max(0, Math.min(this.config.worldWidth * this.config.tileSize - this.player.w, this.player.x));
                
                // Collision avec le sol (simplifié)
                const groundY = this.getGroundY(this.player.x);
                if (this.player.y + this.player.h >= groundY) {
                    this.player.y = groundY - this.player.h;
                    this.player.vy = 0;
                    this.player.onGround = true;
                }
                
                // Mettre à jour la profondeur
                this.gameState.depth = Math.max(0, Math.floor((this.player.y - 50) / 10));
            }

            getGroundY(x) {
                // Calcul simplifié du sol basé sur la position
                const tileX = Math.floor(x / this.config.tileSize);
                const tileY = Math.floor(this.player.y / this.config.tileSize);
                
                // Chercher le premier bloc solide sous le joueur
                for (let y = tileY; y < this.config.worldHeight; y++) {
                    if (this.world.tiles[y] && this.world.tiles[y][tileX] > 0) {
                        return y * this.config.tileSize;
                    }
                }
                
                return this.config.worldHeight * this.config.tileSize;
            }

            updateCamera() {
                // Caméra qui suit le joueur
                this.camera.x = this.player.x - this.canvas.width / 2;
                this.camera.y = this.player.y - this.canvas.height / 2;
                
                // Limiter la caméra aux bords du monde
                this.camera.x = Math.max(0, Math.min(this.config.worldWidth * this.config.tileSize - this.canvas.width, this.camera.x));
                this.camera.y = Math.max(0, Math.min(this.config.worldHeight * this.config.tileSize - this.canvas.height, this.camera.y));
            }

            updateGameInterface() {
                // Déterminer le biome actuel
                const playerTileY = Math.floor(this.player.y / this.config.tileSize);
                const currentBiome = this.getBiomeAtDepth(playerTileY);
                
                if (currentBiome !== this.gameState.currentBiome) {
                    this.gameState.currentBiome = currentBiome;
                    this.onBiomeChange(currentBiome);
                }
                
                // Mettre à jour l'indicateur de biome
                const biomeData = this.worldGenerator.biomes[currentBiome];
                if (biomeData) {
                    document.getElementById('biomeName').textContent = biomeData.name;
                    document.getElementById('biomeDescription').textContent = this.getBiomeDescription(currentBiome);
                }
                
                // Mettre à jour l'indicateur de profondeur
                document.getElementById('depthValue').textContent = this.gameState.depth;
                
                // Mettre à jour la minimap
                this.updateMinimap();
            }

            getBiomeAtDepth(tileY) {
                const ratio = tileY / this.config.worldHeight;
                
                if (ratio < 0.08) return "DIVINE_PEAKS";
                if (ratio < 0.17) return "CELESTIAL_GARDENS";
                if (ratio < 0.25) return "CLOUD_REALM";
                if (ratio < 0.33) return "ENCHANTED_FOREST";
                if (ratio < 0.42) return "CRYSTAL_CAVERNS";
                if (ratio < 0.50) return "GOLDEN_PLAINS";
                if (ratio < 0.58) return "MYSTIC_SWAMPS";
                if (ratio < 0.67) return "DESERT_RUINS";
                if (ratio < 0.75) return "VOLCANIC_LANDS";
                if (ratio < 0.83) return "SHADOW_REALM";
                if (ratio < 0.92) return "INFERNAL_DEPTHS";
                return "ABYSS";
            }

            getBiomeDescription(biome) {
                const descriptions = {
                    "DIVINE_PEAKS": "Royaume des anges et de la lumière éternelle",
                    "CELESTIAL_GARDENS": "Jardins paradisiaques aux fleurs immortelles",
                    "CLOUD_REALM": "Domaine des nuages et des vents célestes",
                    "ENCHANTED_FOREST": "Forêt magique peuplée d'esprits anciens",
                    "CRYSTAL_CAVERNS": "Cavernes scintillantes de cristaux magiques",
                    "GOLDEN_PLAINS": "Plaines dorées de prospérité et d'abondance",
                    "MYSTIC_SWAMPS": "Marécages mystérieux aux pouvoirs occultes",
                    "DESERT_RUINS": "Ruines antiques dans les sables du temps",
                    "VOLCANIC_LANDS": "Terres de feu et de lave ardente",
                    "SHADOW_REALM": "Royaume des ombres et des secrets",
                    "INFERNAL_DEPTHS": "Profondeurs infernales des démons",
                    "ABYSSE": "L'abîme primordial du chaos éternel"
                };
                
                return descriptions[biome] || "Région inconnue";
            }

            onBiomeChange(newBiome) {
                // Afficher un message de transition
                this.showSystemMessage(`Vous entrez dans: ${this.worldGenerator.biomes[newBiome]?.name || newBiome}`);
                
                // Créer des particules d'ambiance
                this.createBiomeParticles(newBiome);
                
                // Jouer un son d'ambiance (si disponible)
                this.playBiomeAmbience(newBiome);
            }

            createBiomeParticles(biome) {
                const particleCount = 20;
                const particleTypes = {
                    "DIVINE_PEAKS": "divine-particle",
                    "INFERNAL_DEPTHS": "infernal-particle",
                    "ABYSS": "infernal-particle"
                };
                
                const particleType = particleTypes[biome] || "divine-particle";
                
                for (let i = 0; i < particleCount; i++) {
                    setTimeout(() => {
                        this.createParticle(particleType);
                    }, i * 100);
                }
            }

            createParticle(type) {
                const particle = document.createElement('div');
                particle.className = `particle ${type}`;
                particle.style.left = Math.random() * window.innerWidth + 'px';
                particle.style.top = Math.random() * window.innerHeight + 'px';
                
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    particle.remove();
                }, 3000);
            }

            updateMinimap() {
                const playerDot = document.getElementById('playerDot');
                const minimapContent = document.getElementById('minimapContent');
                
                // Calculer la position relative du joueur
                const relativeY = (this.player.y / (this.config.worldHeight * this.config.tileSize)) * minimapContent.clientHeight;
                const relativeX = (this.player.x / (this.config.worldWidth * this.config.tileSize)) * minimapContent.clientWidth;
                
                playerDot.style.left = relativeX + 'px';
                playerDot.style.top = relativeY + 'px';
            }

            checkInteractions() {
                // Vérifier les interactions avec les PNJ
                if (this.keys['e']) {
                    const nearbyNPCs = this.npcSystem.getNPCsInArea(
                        this.player.x + this.player.w / 2,
                        this.player.y + this.player.h / 2,
                        50
                    );
                    
                    if (nearbyNPCs.length > 0) {
                        const npc = nearbyNPCs[0];
                        this.interactWithNPC(npc);
                    }
                }
            }

            interactWithNPC(npc) {
                const response = this.npcSystem.interactWithNPC(npc.id, "player1", "talk");
                
                if (response && this.windowManager) {
                    // Afficher le dialogue via une fenêtre modulaire
                    this.showNPCDialogue(response);
                }
            }

            showNPCDialogue(response) {
                const dialogueContent = `
                    <div class="npc-dialogue" style="text-align: center; margin-bottom: 20px;">
                        <div class="npc-portrait" style="
                            width: 80px;
                            height: 80px;
                            background: linear-gradient(135deg, #9370DB, #8A2BE2);
                            border-radius: 50%;
                            margin: 0 auto 15px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 2rem;
                            color: white;
                        ">
                            <i class="fas fa-user"></i>
                        </div>
                        <h3 style="color: #FFD700; margin-bottom: 10px;">${response.npcName}</h3>
                        <div class="dialogue-text" style="
                            background: rgba(0,0,0,0.3);
                            border: 1px solid #9370DB;
                            border-radius: 8px;
                            padding: 15px;
                            margin-bottom: 20px;
                            color: #E0E0E0;
                            line-height: 1.5;
                        ">
                            ${response.text}
                        </div>
                        ${response.options ? `
                            <div class="dialogue-options">
                                ${response.options.map((option, index) => `
                                    <button class="dialogue-option" style="
                                        background: linear-gradient(135deg, rgba(147, 112, 219, 0.3), rgba(138, 43, 226, 0.3));
                                        border: 1px solid #9370DB;
                                        border-radius: 6px;
                                        color: #E0E0E0;
                                        padding: 10px 15px;
                                        margin: 5px;
                                        cursor: pointer;
                                        transition: all 0.2s ease;
                                        display: block;
                                        width: 100%;
                                    " onmouseover="this.style.background='linear-gradient(135deg, rgba(147, 112, 219, 0.5), rgba(138, 43, 226, 0.5))'"
                                       onmouseout="this.style.background='linear-gradient(135deg, rgba(147, 112, 219, 0.3), rgba(138, 43, 226, 0.3))'"
                                       onclick="window.game.handleDialogueChoice(${index})">
                                        ${option.text}
                                    </button>
                                `).join('')}
                            </div>
                        ` : `
                            <button class="dialogue-option" style="
                                background: linear-gradient(135deg, rgba(147, 112, 219, 0.3), rgba(138, 43, 226, 0.3));
                                border: 1px solid #9370DB;
                                border-radius: 6px;
                                color: #E0E0E0;
                                padding: 10px 20px;
                                cursor: pointer;
                                transition: all 0.2s ease;
                            " onclick="window.windowManager.closeWindow('dialogueWindow')">
                                Continuer
                            </button>
                        `}
                    </div>
                `;
                
                // Mettre à jour le contenu de la fenêtre de dialogue
                const dialogueContentEl = document.getElementById('dialogueContent');
                if (dialogueContentEl) {
                    dialogueContentEl.innerHTML = dialogueContent;
                }
                
                // Afficher la fenêtre de dialogue
                this.windowManager.showWindow('dialogueWindow');
            }

            handleDialogueChoice(choiceIndex) {
                // Gérer le choix du joueur dans le dialogue
                console.log(`Choix sélectionné: ${choiceIndex}`);
                this.windowManager.closeWindow('dialogueWindow');
            }

            render() {
                if (!this.renderer || !this.world) return;
                
                // Rendu du monde avancé
                this.renderer.renderWorld(this.world, this.camera, this.config);
                
                // Rendu du joueur
                this.renderPlayer();
            }

            renderPlayer() {
                const { ctx } = this;
                
                ctx.save();
                
                // Position du joueur à l'écran
                const screenX = this.player.x - this.camera.x;
                const screenY = this.player.y - this.camera.y;
                
                // Rendu simple du joueur
                ctx.fillStyle = '#00FF00';
                ctx.fillRect(screenX, screenY, this.player.w, this.player.h);
                
                // Aura basée sur l'alignement
                if (this.player.alignment === "good") {
                    ctx.shadowColor = '#FFD700';
                    ctx.shadowBlur = 10;
                } else if (this.player.alignment === "evil") {
                    ctx.shadowColor = '#FF0000';
                    ctx.shadowBlur = 10;
                }
                
                ctx.restore();
            }

            handleKeyPress(key) {
                switch (key) {
                    case 'm':
                        // Ouvrir la carte
                        if (this.windowManager) {
                            this.windowManager.toggleWindow('mapWindow');
                        }
                        break;
                        
                    case 'i':
                        // Ouvrir l'inventaire
                        if (this.windowManager) {
                            this.windowManager.toggleWindow('inventoryWindow');
                        }
                        break;
                        
                    case 'c':
                        // Ouvrir le menu personnage
                        if (this.windowManager) {
                            this.windowManager.toggleWindow('characterWindow');
                        }
                        break;
                        
                    case 'q':
                        // Ouvrir les quêtes
                        if (this.windowManager) {
                            this.windowManager.toggleWindow('questWindow');
                        }
                        break;
                        
                    case 'j':
                        // Ouvrir le journal
                        if (this.windowManager) {
                            this.windowManager.toggleWindow('journalWindow');
                        }
                        break;
                        
                    case 'o':
                        // Ouvrir l'artisanat
                        if (this.windowManager) {
                            this.windowManager.toggleWindow('craftingWindow');
                        }
                        break;
                        
                    case 'escape':
                        // Pause
                        this.gameState.paused = !this.gameState.paused;
                        this.showSystemMessage(this.gameState.paused ? "Jeu en pause" : "Jeu repris");
                        break;
                }
            }

            handleMouseClick(x, y) {
                // Gestion des clics de souris
                this.mouse.clicked = false;
            }

            showSystemMessage(message) {
                const messageEl = document.getElementById('systemMessage');
                messageEl.textContent = message;
                messageEl.classList.add('visible');
                
                setTimeout(() => {
                    messageEl.classList.remove('visible');
                }, 3000);
            }

            playBiomeAmbience(biome) {
                // Jouer les sons d'ambiance (à implémenter)
                console.log(`🎵 Ambiance: ${biome}`);
            }

            updateLoadingProgress(percent, text, details) {
                document.getElementById('loadingFill').style.width = percent + '%';
                document.getElementById('loadingText').textContent = text;
                document.getElementById('loadingDetails').textContent = details;
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Initialiser le jeu
        window.addEventListener('load', () => {
            const game = new ParadiseToHellGame();
            window.game = game; // Pour le debug
        });

        console.log('🎮 Super Pixel Adventure 2 - Du Paradis à l\'Enfer');
        console.log('🌟 Préparez-vous pour une odyssée épique à travers tous les royaumes!');
        console.log('📋 Fonctionnalités:');
        console.log('   • Monde vertical du Paradis à l\'Enfer');
        console.log('   • 12 biomes uniques avec créatures spéciales');
        console.log('   • PNJ avancés avec IA et dialogues riches');
        console.log('   • Système de quêtes dynamiques');
        console.log('   • Interface modulaire complète');
        console.log('   • Rendu avancé avec effets visuels');
    </script>
</body>
</html>