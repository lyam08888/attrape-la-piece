<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Monde Complexe</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: var(--background-dark);
            color: var(--text-light);
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-section {
            background: #2a2a2a;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .test-section.error {
            border-left-color: #f44336;
        }
        
        .test-section.warning {
            border-left-color: #ff9800;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button.danger {
            background: #f44336;
        }
        
        button.danger:hover {
            background: #da190b;
        }
        
        .log-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: inherit;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-item {
            background: #333;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
        }
        
        .status-item.success {
            background: #2e7d32;
        }
        
        .status-item.error {
            background: #c62828;
        }
        
        .status-item.warning {
            background: #f57c00;
        }
        
        canvas {
            border: 2px solid #666;
            margin: 20px 0;
            display: block;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test du Monde Complexe</h1>
        
        <div class="test-section">
            <h2>üéÆ Contr√¥les de Test</h2>
            <div class="test-controls">
                <button onclick="initializeGame()">üöÄ Initialiser le Jeu</button>
                <button onclick="testWorldGeneration()">üåç Tester G√©n√©ration</button>
                <button onclick="testAnimalSystem()">üêÑ Tester Animaux</button>
                <button onclick="testFoodSystem()">üçé Tester Nourriture</button>
                <button onclick="testEnemySystem()">üëπ Tester Ennemis</button>
                <button onclick="testDisasters()">‚ö° Tester D√©sastres</button>
                <button onclick="testBiomes()">üå≤ Tester Biomes</button>
                <button onclick="clearLogs()" class="danger">üóëÔ∏è Vider Logs</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üìä √âtat des Syst√®mes</h2>
            <div class="status-grid" id="systemStatus">
                <!-- Statuts g√©n√©r√©s dynamiquement -->
            </div>
        </div>
        
        <div class="test-section">
            <h2>üñºÔ∏è Aper√ßu du Monde</h2>
            <canvas id="worldPreview" width="800" height="400"></canvas>
        </div>
        
        <div class="test-section">
            <h2>üìù Logs de Test</h2>
            <div class="log-output" id="testLogs"></div>
        </div>
    </div>

    <script type="module">
        let game = null;
        let config = null;
        
        // Fonction de logging
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('testLogs');
            const prefix = type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            logElement.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[TEST] ${message}`);
        }
        
        // Fonction pour mettre √† jour le statut des syst√®mes
        function updateSystemStatus() {
            const statusGrid = document.getElementById('systemStatus');
            const systems = [
                { name: 'Monde Complexe', key: 'complexWorldSystem' },
                { name: 'Animaux', key: 'animalManager' },
                { name: 'Nourriture', key: 'foodSystem' },
                { name: 'Ennemis', key: 'enemySpawner' },
                { name: 'D√©sastres', key: 'disasterManager' },
                { name: 'Biomes', key: 'advancedBiomeSystem' },
                { name: 'Qu√™tes', key: 'questSystem' },
                { name: 'Int√©gration', key: 'worldIntegration' }
            ];
            
            statusGrid.innerHTML = systems.map(system => {
                const status = game && game[system.key] ? 'success' : 'error';
                const statusText = status === 'success' ? 'Actif' : 'Inactif';
                return `
                    <div class="status-item ${status}">
                        <h3>${system.name}</h3>
                        <p>${statusText}</p>
                    </div>
                `;
            }).join('');
        }
        
        // Initialiser le jeu
        window.initializeGame = async function() {
            try {
                log('Initialisation du jeu...', 'info');
                
                // Charger la configuration
                const configResponse = await fetch('./config.json');
                config = await configResponse.json();
                log('Configuration charg√©e', 'success');
                
                // Cr√©er l'objet game
                game = {
                    tileMap: [],
                    player: null,
                    enemies: [],
                    collectibles: [],
                    chests: [],
                    particles: [],
                    camera: { x: 0, y: 0 },
                    config: config
                };
                
                // Importer et initialiser les syst√®mes
                const { ComplexWorldSystem } = await import('./worldComplexSystem.js');
                game.complexWorldSystem = new ComplexWorldSystem(config);
                log('Syst√®me de monde complexe initialis√©', 'success');
                
                const { AnimalManager } = await import('./animalSystem.js');
                game.animalManager = new AnimalManager();
                log('Syst√®me d\'animaux initialis√©', 'success');
                
                const { FoodSystem } = await import('./foodSystem.js');
                game.foodSystem = new FoodSystem();
                log('Syst√®me de nourriture initialis√©', 'success');
                
                const { EnemySpawner } = await import('./enemySpawner.js');
                game.enemySpawner = new EnemySpawner(config);
                log('Syst√®me d\'ennemis initialis√©', 'success');
                
                const { DisasterManager } = await import('./disasterManager.js');
                // Fournir l'objet de jeu pour que le gestionnaire de d√©sastres
                // puisse utiliser la cam√©ra et les autres donn√©es du jeu
                game.disasterManager = new DisasterManager(game);
                log('Syst√®me de d√©sastres initialis√©', 'success');
                
                const { AdvancedBiomeSystem } = await import('./advancedBiomeSystem.js');
                game.advancedBiomeSystem = new AdvancedBiomeSystem(config);
                log('Syst√®me de biomes avanc√© initialis√©', 'success');
                
                const { QuestSystem } = await import('./questSystem.js');
                game.questSystem = new QuestSystem();
                log('Syst√®me de qu√™tes initialis√©', 'success');
                
                const { integrateComplexWorld } = await import('./gameIntegration.js');
                game.worldIntegration = integrateComplexWorld(game, config, {});
                log('Int√©gration du monde complexe r√©ussie', 'success');
                
                updateSystemStatus();
                log('Tous les syst√®mes initialis√©s avec succ√®s!', 'success');
                
            } catch (error) {
                log(`Erreur lors de l'initialisation: ${error.message}`, 'error');
                console.error(error);
            }
        };
        
        // Tester la g√©n√©ration de monde
        window.testWorldGeneration = async function() {
            if (!game) {
                log('Veuillez d\'abord initialiser le jeu', 'warning');
                return;
            }
            
            try {
                log('Test de g√©n√©ration de monde...', 'info');
                
                const { generateLevel } = await import('./world.js');
                game.tileMap = generateLevel(game, config);
                
                log(`Monde g√©n√©r√©: ${game.tileMap.length} lignes x ${game.tileMap[0]?.length || 0} colonnes`, 'success');
                
                // Dessiner un aper√ßu du monde
                drawWorldPreview();
                
            } catch (error) {
                log(`Erreur g√©n√©ration monde: ${error.message}`, 'error');
            }
        };
        
        // Tester le syst√®me d'animaux
        window.testAnimalSystem = function() {
            if (!game || !game.animalManager) {
                log('Syst√®me d\'animaux non disponible', 'warning');
                return;
            }
            
            try {
                log('Test du syst√®me d\'animaux...', 'info');
                
                // Spawn quelques animaux de test
                const animalTypes = ['cow', 'pig', 'chicken', 'sheep', 'rabbit'];
                animalTypes.forEach(type => {
                    game.animalManager.spawnAnimal(game, type);
                });
                
                log(`${animalTypes.length} animaux g√©n√©r√©s pour test`, 'success');
                log(`Total animaux: ${game.animalManager.animals.length}`, 'info');
                
            } catch (error) {
                log(`Erreur test animaux: ${error.message}`, 'error');
            }
        };
        
        // Tester le syst√®me de nourriture
        window.testFoodSystem = function() {
            if (!game || !game.foodSystem) {
                log('Syst√®me de nourriture non disponible', 'warning');
                return;
            }
            
            try {
                log('Test du syst√®me de nourriture...', 'info');
                
                // G√©n√©rer quelques sources de nourriture
                game.foodSystem.generateFoodSources(game, 10);
                
                log('Sources de nourriture g√©n√©r√©es', 'success');
                log(`Fruits sur arbres: ${game.foodSystem.treeFruits.size}`, 'info');
                log(`Objets alimentaires: ${game.foodSystem.foodItems.length}`, 'info');
                
            } catch (error) {
                log(`Erreur test nourriture: ${error.message}`, 'error');
            }
        };
        
        // Tester le syst√®me d'ennemis
        window.testEnemySystem = function() {
            if (!game || !game.enemySpawner) {
                log('Syst√®me d\'ennemis non disponible', 'warning');
                return;
            }
            
            try {
                log('Test du syst√®me d\'ennemis...', 'info');
                
                // Cr√©er un joueur fictif pour les tests
                if (!game.player) {
                    game.player = { x: 400, y: 300, w: 32, h: 32 };
                }
                
                // Forcer le spawn de quelques ennemis
                for (let i = 0; i < 5; i++) {
                    game.enemySpawner.trySpawnEnemy(game);
                }
                
                log(`Ennemis g√©n√©r√©s: ${game.enemies.length}`, 'success');
                
            } catch (error) {
                log(`Erreur test ennemis: ${error.message}`, 'error');
            }
        };
        
        // Tester les d√©sastres
        window.testDisasters = function() {
            if (!game || !game.disasterManager) {
                log('Syst√®me de d√©sastres non disponible', 'warning');
                return;
            }
            
            try {
                log('Test du syst√®me de d√©sastres...', 'info');
                
                // D√©clencher un d√©sastre de test
                game.disasterManager.triggerDisaster('meteor_shower', { intensity: 0.5 });
                
                log('D√©sastre d√©clench√©: Pluie de m√©t√©ores', 'success');
                
            } catch (error) {
                log(`Erreur test d√©sastres: ${error.message}`, 'error');
            }
        };
        
        // Tester les biomes
        window.testBiomes = function() {
            if (!game || !game.advancedBiomeSystem) {
                log('Syst√®me de biomes non disponible', 'warning');
                return;
            }
            
            try {
                log('Test du syst√®me de biomes...', 'info');
                
                const biomes = Object.keys(game.advancedBiomeSystem.biomes);
                log(`Biomes disponibles: ${biomes.length}`, 'success');
                log(`Biomes: ${biomes.join(', ')}`, 'info');
                
                // Tester la d√©tection de biome
                const currentBiome = game.advancedBiomeSystem.getBiomeAt(400, 300);
                log(`Biome √† (400, 300): ${currentBiome}`, 'info');
                
            } catch (error) {
                log(`Erreur test biomes: ${error.message}`, 'error');
            }
        };
        
        // Dessiner un aper√ßu du monde
        function drawWorldPreview() {
            const canvas = document.getElementById('worldPreview');
            const ctx = canvas.getContext('2d');
            
            if (!game.tileMap || !game.tileMap.length) {
                ctx.fillStyle = '#333';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#fff';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Aucun monde g√©n√©r√©', canvas.width/2, canvas.height/2);
                return;
            }
            
            const worldHeight = game.tileMap.length;
            const worldWidth = game.tileMap[0].length;
            const scaleX = canvas.width / worldWidth;
            const scaleY = canvas.height / worldHeight;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Dessiner un √©chantillon du monde
            const sampleRate = Math.max(1, Math.floor(worldWidth / canvas.width));
            
            for (let y = 0; y < worldHeight; y += sampleRate) {
                for (let x = 0; x < worldWidth; x += sampleRate) {
                    const tile = game.tileMap[y][x];
                    if (tile > 0) {
                        // Couleurs simplifi√©es pour l'aper√ßu
                        const colors = {
                            1: '#228B22', // Herbe
                            2: '#8B4513', // Terre
                            3: '#696969', // Pierre
                            4: '#DEB887', // Bois
                            5: '#32CD32', // Feuilles
                            9: '#4169E1', // Eau
                            15: '#F4A460' // Sable
                        };
                        
                        ctx.fillStyle = colors[tile] || '#666';
                        ctx.fillRect(x * scaleX, y * scaleY, scaleX + 1, scaleY + 1);
                    }
                }
            }
            
            log('Aper√ßu du monde mis √† jour', 'info');
        }
        
        // Vider les logs
        window.clearLogs = function() {
            document.getElementById('testLogs').textContent = '';
            log('Logs vid√©s', 'info');
        };
        
        // Initialisation automatique
        updateSystemStatus();
        log('Interface de test pr√™te', 'success');
        log('Cliquez sur "Initialiser le Jeu" pour commencer', 'info');
    </script>
</body>
</html>